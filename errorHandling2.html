<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>

    .loader {
      border: 16px solid #f3f3f3; /* Light grey */
      border-top: 16px solid #a6ff00; /* Blue */
      border-radius: 50%;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    </style>
<script>


// var input = document.getElementById('username');
// var form  = document.getElementById('form');

// var elem               = document.createElement('div');
//     elem.id            = 'notify';
//     elem.style.display = 'none';
//     form.appendChild(elem);


//     input.addEventListener('invalid', function(event){
//     event.preventDefault();
//     if ( ! event.target.validity.valid ) {
//         elem.textContent   = 'Username should only contain lowercase letters e.g. john';
//         elem.className     = 'error';
//         elem.style.display = 'block';
 
//         input.className    = 'invalid animated shake';
//     }
// });



// input.addEventListener('input', function(event){
//     if ( 'block' === elem.style.display ) {
//         input.className = '';
//         elem.style.display = 'none';
//     }
// });

function validateForm()  {
  const x = document.forms["myForm"]["fname"].value;

  const len = x.toString().length;
  if (len === 9) {
    alert('Good 1');
    return true;
  } else {
    alert('Failed to fetch 1');
    return true;
  }
  
  // const numToSeperate = x;
  // const arrayOfDigits = Array.from(String(numToSeperate), Number);
  // console.log(arrayOfDigits);
  // if ( arrayOfDigits > 9) {
  //   alert("Failed to fetch 2");
  //   return true
  //   ;
  // } else {
  //   alert("Good 2");
  //   return true;
  // }

}


</script>
</head>
<!-- 
<style>
  form {
  
  }
  </style> -->


<div class="container" id="p">
  <div class="row row-cols-2" id="main">

    <div class="col">Column 1
      <body>

        <h4>COMPANY:</h4>
        <input type="text" name="fname"  maxlength="10">
        <button type="button" onclick="clickpress()">Click Me!</button>
        <form name="myForm" onsubmit="return validateForm()">
          CompanyId: <input type="text" name="fname" minlength="9" maxlength="9">
          <input type="submit" value="Search">
          
          
        </form>
        
        
        
        <form action="">
          <label for="QueueId">QueueId:</label>
          <select name="Queueid" id="QueueId">
            <option value="QueueId">QUEUE00001</option>
            <option value="QueueId">QUEUE00002</option>
            <option value="QueueId">QUEUE00003</option>
            <input type="checkbox" id="hideinactive" name="hideinactive" value="hideinactive">
            <label for="hideinactive" > Hide inactive</label><br>
          </select>
          <br><br>
       

        
    </div>

    <div id="col2" class="col" >Column 2
      
      <form name="myForm">
        <input
        id="field"
    type="text"
    name="fname"
    placeholder="CompanyId"
    pattern="[0-9]{10}"
    maxlength="10"
    title="ComapnyID should only contain in total nine numbers, does not allow symbols">
      
        
        
      </form>
      <button type="button" onclick="submit()">Submit</button>
        
  
  
      
      
      
      <form id="form" >
        <label for="QueueId">QueueId:</label>
        <select name="Queueid" id="QueueId2">
          <!-- <option value="QueueId">QUEUE00001</option>
          <option value="QueueId">QUEUE00002</option>
          <option value="QueueId">QUEUE00003</option> -->
          <input type="checkbox" id="hide2" name="hideinactive" value="hideinactive" onclick="hide()">
       <label  for="hideinactive" > Hide inactive</label><br>
        </select>
        <br><br>
        </form>
        <div id="load" class="loader" style="display: none;"></div>
         
        <button onclick="press()">Add another</button>
      
       


      

    </div>
    <script>
      function press(){
       var div = document.createElement("div");
     div.className="col";
     var h1=document.createElement("h3");
     h1.innerHTML="Company id";
     var inout= document.createElement("input");
     var button= document.createElement("button");
     button.innerHTML="send";
     button.setAttribute("onclick","submit()")
     var label=document.createElement("label");
     label.innerHTML="queueid";
     var dropdown= document.createElement("select");
     dropdown.id="drop";
     div.appendChild(h1);
  
     div.appendChild(inout);
     div.appendChild(button);
     div.appendChild(dropdown);
     document.getElementById("main").appendChild(div);


      // alert("hello");
      }
     function myFunction() {
       alert(90);
       var div = document.createElement("div");
       div.innerText = "This is a paragraph.";
       document.getElementById("class").appendChild(para);
     }
     function submit(params) {
     var comp=  document.getElementById("field").value;
document.getElementById("load").style.display="inline-block";
      $.get(`https://ades-2b04.herokuapp.com/company/queue?company_id=${comp}`, function(data, status){
        document.getElementById("load").style.display="none";
for (let index = 0; index < data.length; index++) {

  console.log("QUEUE"+data[index].queue_id +"ACTIVE"+ data[index].is_active);
  var queue=data[index].queue_id;
  var status =data[index].is_active;
  var dropdown= document.createElement("option");
  dropdown.innerHTML=queue;
  dropdown.id=index;
  dropdown.value=queue;
  if(status==0){
    dropdown.value="no";  
    dropdown.innerHTML=queue+" not active";
  }

  var finalDrop=document.getElementById("QueueId2");
  finalDrop.appendChild(dropdown);
  var graph= document.createElement("div");
  graph.id="chartContainer";
  graph.style.height=10000;
  graph.style.width="100%";
  var main = document.getElementById("p");

  main.appendChild(graph);
  graphh(document.getElementById("QueueId2").value);








  
}
var a= document.createElement("a");
 // button.setAttribute("onclick", "window.location.href='./graph.html';");
 a.href="graph.html"
  a.innerHTML="check queue"
  var append= document.getElementById("form");
  append.appendChild(a);
  console.log(document.getElementById("QueueId2"));
   window.setInterval(function(){
  /// call your function here
  localStorage.setItem('label',document.getElementById("QueueId2").value)
}, 1000);
  
  });
     }
     function hide(params) {
       console.log("call");
       var checkbox= document.getElementById("hide2");
       var dropdownCount = document.getElementById("QueueId2").childElementCount;
       if(checkbox.checked==true){
for(i=0;i<dropdownCount;i++){
  console.log(document.getElementById(i));
  if(document.getElementById(i).value=="no"){
    document.getElementById(i).style.display="none";
  }
}
       }
       else{
        for(i=0;i<dropdownCount;i++){

    document.getElementById(i).style.display="inline-block";
  
}

       }
     }

     function graphh (x) {
         // var x=localStorage.getItem('label');
      console.log(x);
      var dps = []; // dataPoints
      var chart = new CanvasJS.Chart("chartContainer", {
        title :{
          text: "ARRIVAL RATE "+x
          },
          axisX: {
              title: "Time"
          },
          axisY: {
              title: "No of request"
          },
        data: [{
          type: "line",
          dataPoints: dps
        }]
      });
      
      
      var updateInterval = 1000;
      
      
      var updateChart = function (count) {
      var d = new Date();
      var tree= new Date(d.getTime() - 60000 *3);
      
      
      length = length || 1;
          $.get(`https://ades-2b04.herokuapp.com/company/arrival_rate?queue_id=${x}&from=${tree.toISOString()}&duration=3`, 
          function (data, status) {
      var final=[];
      for (let index = 0; index < data.length; index++) {
         final.push({
             x: data[index].timestamp,
             y: parseInt(data[index].count)
         })
          console.log(data[index].timestamp);
      }
      
      dps.splice(0, dps.length, ...final);
      chart.render();
      
          })
      };
      
      updateChart();
      setInterval(function(){updateChart()}, updateInterval);
      
      }
     </script>
     <script>
    
      </script>
     <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 
    

</html>